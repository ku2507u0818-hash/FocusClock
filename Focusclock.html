<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FocusClock — Time Manager</title>
<style>
  :root{
    --bg:#0b0b0b; --card:#111217; --muted:#9aa0a6; --accent:#4d9aff;
    --accent2:#6dd3a9; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, system-ui, Arial, sans-serif;
    background:var(--bg); color:#fff; -webkit-font-smoothing:antialiased;
  }

  /* Intro overlay */
  #intro {
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    flex-direction:column; background:linear-gradient(180deg,#000,#0a0a0a); z-index:40;
    animation:introAppear 0.6s ease forwards;
  }
  @keyframes introAppear{from{opacity:0; transform:scale(.98)} to{opacity:1; transform:scale(1)}}
  .intro-title{font-size:48px; font-weight:800; letter-spacing:2px; margin-bottom:8px}
  .intro-sub{color:var(--muted); margin-bottom:20px}
  .enter-btn{background:var(--accent); color:#fff; border:none; padding:12px 22px; border-radius:10px; cursor:pointer; font-weight:700}

  /* Layout */
  header{display:flex; align-items:center; justify-content:space-between; padding:18px 28px; border-bottom:1px solid rgba(255,255,255,0.03); position:sticky; top:0; background:rgba(8,8,8,0.9); z-index:10}
  .brand{font-weight:800; font-size:22px}
  .top-right{display:flex; gap:14px; align-items:center}
  .live-clock{color:var(--muted); font-weight:600}

  main{max-width:900px; margin:28px auto; padding:0 18px 120px}

  .quote{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px 16px; border-radius:12px; color:var(--muted); margin-bottom:16px}

  /* Add task */
  .add-wrap{display:flex; gap:14px; align-items:flex-start; margin-bottom:18px}
  .add-card{flex:1; background:var(--card); padding:14px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .row{display:flex; gap:10px}
  input[type=text], input[type=time], input[type=number], select{
    width:100%; padding:10px; border-radius:8px; border:none; background:#0f1113; color:#fff; font-size:14px;
  }
  label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  .small{width:110px}
  .add-actions{display:flex; gap:10px; margin-top:10px}
  .btn{background:#222428; border:none; padding:8px 12px; color:#fff; border-radius:8px; cursor:pointer}
  .btn-primary{background:var(--accent); font-weight:700}
  .preset{background:#1a1a1a; padding:8px 10px; border-radius:8px; cursor:pointer; color:var(--muted); border:1px solid rgba(255,255,255,0.02)}

  /* Tasks */
  #list{display:flex; flex-direction:column; gap:12px}
  .task{background:var(--card); padding:16px; border-radius:14px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .left{display:flex; gap:14px; align-items:center}
  .dot{width:14px; height:14px; border-radius:50%}
  .title{font-weight:700}
  .meta{color:var(--muted); font-size:13px}
  .controls{display:flex; gap:8px; align-items:center}
  .small-btn{background:#141416; border:none; padding:8px 10px; border-radius:8px; color:#fff; cursor:pointer}
  .small-btn.pause{background:#2b2b2b}
  .done{opacity:0.5; text-decoration:line-through}

  /* timer display */
  .timer-big{font-size:28px; font-weight:700; letter-spacing:1px}

  /* bottom progress */
  .progress-wrap{position:fixed; left:0; right:0; bottom:0; background:rgba(5,5,5,0.96); border-top:1px solid rgba(255,255,255,0.03); padding:12px 18px}
  .progress-inner{max-width:900px; margin:0 auto; display:flex; align-items:center; gap:16px}
  .pbar{flex:1; background:#121214; height:10px; border-radius:999px; overflow:hidden}
  .pfill{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .5s ease}
  .ptext{color:var(--muted); min-width:200px; text-align:right}

  /* stats */
  .stats{display:flex; gap:12px; margin-top:14px}
  .stat-card{background:#0f1113; padding:10px 12px; border-radius:10px; font-size:13px; color:var(--muted)}

  @media(max-width:760px){
    .add-wrap{flex-direction:column}
    .small{width:100%}
    .ptext{display:none}
  }
</style>
</head>
<body>

<!-- intro overlay -->
<div id="intro">
  <div class="intro-title">FocusClock</div>
  <div class="intro-sub">Focus. Track. Finish.</div>
  <button class="enter-btn" id="enterBtn">Enter App</button>
</div>

<header>
  <div class="brand">FocusClock</div>
  <div class="top-right">
    <div class="quote" id="quoteBox">Loading motivational quote…</div>
    <div class="live-clock" id="liveClock">--:--:--</div>
  </div>
</header>

<main>
  <!-- add task -->
  <div class="add-wrap">
    <div class="add-card" style="flex:1">
      <label>Task name</label>
      <input type="text" id="taskName" placeholder="e.g., Swimming, Read chapter 5" />

      <div style="display:flex; gap:10px; margin-top:8px;">
        <div style="flex:1">
          <label>Start</label>
          <input type="time" id="taskStart" />
        </div>
        <div style="flex:1">
          <label>End</label>
          <input type="time" id="taskEnd" />
        </div>
        <div style="width:120px">
          <label>Duration (min)</label>
          <input type="number" id="taskMin" min="1" placeholder="25" />
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top:8px; align-items:center;">
        <div style="flex:1">
          <label>Color</label>
          <select id="taskColor">
            <option value="#4d9aff">Blue</option>
            <option value="#f5c542">Yellow</option>
            <option value="#4dd39b">Green</option>
            <option value="#ff6b6b">Red</option>
          </select>
        </div>
        <div style="display:flex; gap:8px; align-items:center;">
          <div class="preset" onclick="setPreset(25)">Pomodoro 25</div>
          <div class="preset" onclick="setPreset(50)">Long 50</div>
          <div class="preset" onclick="setPreset(15)">Short 15</div>
        </div>
      </div>

      <div class="add-actions" style="margin-top:12px">
        <button class="btn btn-primary" onclick="addTask()">Add Task</button>
        <button class="btn" onclick="clearInputs()">Clear</button>
        <div style="flex:1"></div>
        <div style="color:var(--muted); font-size:13px; align-self:center" id="saveHint">Autosave: ON</div>
      </div>

      <div class="stats" style="margin-top:12px">
        <div class="stat-card">Total tasks: <span id="statTotal">0</span></div>
        <div class="stat-card">Completed: <span id="statDone">0</span></div>
        <div class="stat-card">Focus time: <span id="statTime">0m</span></div>
      </div>
    </div>
  </div>

  <!-- task list -->
  <div id="list"></div>
</main>

<!-- bottom progress -->
<div class="progress-wrap">
  <div class="progress-inner">
    <div class="pbar"><div id="pfill" class="pfill"></div></div>
    <div class="ptext" id="ptext">0% • 0 / 0</div>
  </div>
</div>

<!-- small ding -->
<audio id="ding" preload="auto">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
</audio>

<script>
/*
  FocusClock - Single HTML app
  - tasks saved in localStorage under 'fc_tasks_v1'
  - stats saved in 'fc_stats_v1'
*/

const STORAGE_KEY = 'fc_tasks_v1';
const STATS_KEY = 'fc_stats_v1';
const ding = document.getElementById('ding');

let tasks = []; // {id,title,start,end,minutes,color,elapsed, running, completed, createdOn}
let stats = { totalTime: 0 }; // total minutes focused historically

// --- Utility / formatters ---
function fmtClock(date=new Date()){
  return date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
}
function fmtHM(timeStr){ // "HH:MM" -> convert to AM/PM
  if(!timeStr) return '--:--';
  const [h,m] = timeStr.split(':'); let hh = parseInt(h);
  const period = hh>=12 ? 'PM' : 'AM';
  hh = hh%12 || 12;
  return `${hh}:${m} ${period}`;
}
function fmtHMS(sec){
  const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
  return (h>0? String(h).padStart(2,'0')+':' : '') + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}

// --- Persistence ---
function save(){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); localStorage.setItem(STATS_KEY, JSON.stringify(stats)); }
  catch(e){ console.warn('save failed', e); }
}
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    const st = localStorage.getItem(STATS_KEY);
    if(raw) tasks = JSON.parse(raw);
    if(st) stats = JSON.parse(st);
  }catch(e){ console.warn('load failed', e); tasks=[]; stats={ totalTime:0} }
}

// --- render / UI ---
const listEl = document.getElementById('list');
const statTotalEl = document.getElementById('statTotal');
const statDoneEl = document.getElementById('statDone');
const statTimeEl = document.getElementById('statTime');
const pfill = document.getElementById('pfill');
const ptext = document.getElementById('ptext');
const quoteBox = document.getElementById('quoteBox');

function render(){
  listEl.innerHTML = '';
  tasks.forEach(t => {
    const wrap = document.createElement('div');
    wrap.className = 'task' + (t.completed ? ' done' : '');
    wrap.id = 'task-'+t.id;

    const left = document.createElement('div'); left.className='left';
    const dot = document.createElement('div'); dot.className='dot'; dot.style.background = t.color || '#4d9aff';
    left.appendChild(dot);

    const info = document.createElement('div');
    const title = document.createElement('div'); title.className='title'; title.innerText = t.title || 'Untitled';
    const meta = document.createElement('div'); meta.className='meta'; meta.innerText = `${fmtHM(t.start)} — ${fmtHM(t.end)}`;
    const timer = document.createElement('div'); timer.className='timer-big'; timer.id = 'timer-'+t.id; timer.innerText = fmtHMS(t.elapsed || 0);

    info.appendChild(title); info.appendChild(meta); info.appendChild(timer);
    left.appendChild(info);

    const controls = document.createElement('div'); controls.className='controls';
    // Start / Pause / Reset / Done / Delete
    const startBtn = document.createElement('button'); startBtn.className='small-btn'; startBtn.innerText='Start';
    startBtn.onclick = ()=> startTask(t.id);
    const pauseBtn = document.createElement('button'); pauseBtn.className='small-btn pause'; pauseBtn.innerText='Pause';
    pauseBtn.onclick = ()=> pauseTask(t.id);
    const resetBtn = document.createElement('button'); resetBtn.className='small-btn'; resetBtn.innerText='Reset';
    resetBtn.onclick = ()=> resetTask(t.id);
    const doneBtn = document.createElement('button'); doneBtn.className='small-btn'; doneBtn.innerText='Done';
    doneBtn.onclick = ()=> completeTask(t.id);
    const delBtn = document.createElement('button'); delBtn.className='small-btn'; delBtn.style.background='#2b0f12'; delBtn.innerText='Delete';
    delBtn.onclick = ()=> deleteTask(t.id);

    controls.appendChild(startBtn); controls.appendChild(pauseBtn); controls.appendChild(resetBtn);
    controls.appendChild(doneBtn); controls.appendChild(delBtn);

    // reflect state
    if(t.running) { startBtn.disabled=true; startBtn.style.opacity=.6; pauseBtn.disabled=false; }
    else { startBtn.disabled=false; startBtn.style.opacity=1; pauseBtn.disabled=true; }

    if(t.completed){ startBtn.disabled=true; pauseBtn.disabled=true; doneBtn.disabled=true; resetBtn.disabled=false; wrap.classList.add('done'); }

    wrap.appendChild(left); wrap.appendChild(controls);
    listEl.appendChild(wrap);
  });
  updateStatsUI();
}

function updateStatsUI(){
  const total = tasks.length;
  const done = tasks.filter(t=>t.completed).length;
  const totalSec = tasks.reduce((acc,t)=> acc + (t.elapsed||0), 0);
  statTotalEl.innerText = total;
  statDoneEl.innerText = done;
  statTimeEl.innerText = Math.round((stats.totalTime + totalSec/60)) + 'm';
  const pct = total? Math.round(done/total*100):0;
  pfill.style.width = pct + '%';
  ptext.innerText = `${pct}% • ${done} / ${total}`;
  save();
}

// --- Task operations ---
function addTask(){
  const name = (document.getElementById('taskName').value || '').trim();
  const start = document.getElementById('taskStart').value;
  const end = document.getElementById('taskEnd').value;
  const minutes = parseInt(document.getElementById('taskMin').value) || 25;
  const color = document.getElementById('taskColor').value || '#4d9aff';
  if(!name || !start || !end){ alert('Please fill task name, start and end time'); return; }

  const newT = {
    id: Date.now(),
    title: name,
    start: start,
    end: end,
    minutes: minutes,
    color: color,
    elapsed: 0,
    running: false,
    completed: false,
    createdOn: new Date().toISOString()
  };
  tasks.push(newT);
  totalUpdateAndRender();
  clearInputs();
  // optionally auto-start newly created task:
  // startTask(newT.id);
}

function setPreset(mins){
  document.getElementById('taskMin').value = mins;
}

function clearInputs(){
  document.getElementById('taskName').value = '';
  document.getElementById('taskStart').value = '';
  document.getElementById('taskEnd').value = '';
  document.getElementById('taskMin').value = '';
}

function findTask(id){ return tasks.find(t=>t.id===id) }

function startTask(id){
  const t = findTask(id);
  if(!t || t.completed) return;
  t.running = true;
  t._lastTick = Date.now(); // for accurate increments if needed
  render();
}

function pauseTask(id){
  const t = findTask(id);
  if(!t) return;
  // stop running, update elapsed using _lastTick
  if(t.running && t._lastTick){ t.elapsed += Math.floor((Date.now()-t._lastTick)/1000); }
  t.running = false;
  t._lastTick = null;
  render();
}

function resetTask(id){
  const t = findTask(id);
  if(!t) return;
  t.elapsed = 0; t.running = false; t._lastTick = null; t.completed = false;
  render();
}

function completeTask(id){
  const t = findTask(id);
  if(!t || t.completed) return;
  // finalize increment
  if(t.running && t._lastTick){ t.elapsed += Math.floor((Date.now()-t._lastTick)/1000); }
  t.running = false; t._lastTick = null; t.completed = true;
  // add to historical focus time (minutes)
  stats.totalTime = (stats.totalTime || 0) + Math.round(t.elapsed/60);
  render();
  ding.play().catch(()=>{});
}

function deleteTask(id){
  tasks = tasks.filter(t=>t.id!==id);
  render();
}

// tick - update all running tasks every 1s
function tick(){
  const now = Date.now();
  let changed=false;
  tasks.forEach(t=>{
    if(t.running){
      if(!t._lastTick) t._lastTick = now;
      const delta = Math.floor((now - t._lastTick)/1000);
      if(delta>0){
        t.elapsed += delta;
        t._lastTick = now;
        changed = true;
      }
      // if minutes limit is reached, optionally mark complete
      if(t.minutes && t.elapsed >= t.minutes*60){
        t.running = false; t.completed = true;
        stats.totalTime = (stats.totalTime || 0) + Math.round(t.elapsed/60);
        ding.play().catch(()=>{});
        changed = true;
      }
    }
  });
  if(changed) render(); // render saves as well
}

// --- Live clock & quotes ---
function rotateQuote(){
  const quotes = [
    "Focus on progress, not perfection.",
    "One step at a time — keep going.",
    "Work in silence; let results speak.",
    "You don’t have to be great to start.",
    "Small daily improvements lead to big results."
  ];
  quoteBox.innerText = quotes[Math.floor(Math.random()*quotes.length)];
}

// --- helpers ---
function totalUpdateAndRender(){
  // ensure tasks sorted by created time (or you can sort by start time)
  tasks.sort((a,b)=> a.createdOn ? new Date(a.createdOn)-new Date(b.createdOn): a.id - b.id);
  render();
}

// --- save/load on start ---
load();
render();
rotateQuote();
setInterval(() => { document.getElementById('liveClock').innerText = fmtClock(); }, 1000);
setInterval(tick, 1000); // tick every second

// Save periodically
setInterval(save, 5000);

// Intro button
document.getElementById('enterBtn').addEventListener('click', ()=>{
  document.getElementById('intro').style.display = 'none';
});

// expose a couple functions to global for inline onclicks used in list rendering
window.startTask = startTask;
window.pauseTask = pauseTask;
window.resetTask = resetTask;
window.completeTask = completeTask;
window.deleteTask = deleteTask;
window.addTask = addTask;
window.setPreset = setPreset;
window.clearInputs = clearInputs;

</script>
</body>
</html>
